<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><meta name="keywords" content="null"><meta name="description" content="Feign服务间调用超时问题(结合项目中的TxLCNf框架)1.消费方超时
这里是指，服务方等待消费方返回事务的消息，等待超时(结合txlcn框架来说)；在txlcn分布式事务框架中，消费方调用服务方的接口，调用成功后，睡10s，在提交事务；此时在服务方会报超时的错误信息，该错误和txlcn的配置项： tm.compensate.maxWaitTime"><meta name="author" content="herui"><title>Feign服务间调用超时问题(结合项目中的TxLCNf框架) - 绿色薄荷</title><meta description="Feign服务间调用超时问题(结合项目中的TxLCNf框架)1.消费方超时 这里是指，服务方等待消费方返回事务的消息，等待超时(结合txlcn框架来说)；在txlcn分布式事务框架中，消费方调用服务方的接口，调用成功后，睡10s，在提交事务；此时在服务方会报超时的错误信息，该错误和txlcn的配置项： tm.compensate.maxWaitTime&amp;#x3D;xxxx 有关"><meta property="og:type" content="article"><meta property="og:title" content="Feign服务间调用超时问题(结合项目中的TxLCNf框架)"><meta property="og:url" content="https://hr2812.cn/2019/11/19/feign-time-out-problem-with-txlcn/"><meta property="og:site_name" content="肉の丸子"><meta property="og:description" content="Feign服务间调用超时问题(结合项目中的TxLCNf框架)1.消费方超时 这里是指，服务方等待消费方返回事务的消息，等待超时(结合txlcn框架来说)；在txlcn分布式事务框架中，消费方调用服务方的接口，调用成功后，睡10s，在提交事务；此时在服务方会报超时的错误信息，该错误和txlcn的配置项： tm.compensate.maxWaitTime&amp;#x3D;xxxx 有关"><meta property="og:locale" content="zh"><meta property="article:published_time" content="2019-11-19T07:13:05.000Z"><meta property="article:modified_time" content="2020-09-23T10:07:29.082Z"><meta property="article:author" content="herui"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://hr2812.cn/img/avatar.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://hr2812.cn/2019/11/19/feign-time-out-problem-with-txlcn/"},"headline":"Feign服务间调用超时问题(结合项目中的TxLCNf框架)","image":["https://hr2812.cn/img/avatar.png"],"datePublished":"2019-11-19T07:13:05.000Z","dateModified":"2020-09-23T10:07:29.082Z","author":{"@type":"Person","name":"herui"},"description":"Feign服务间调用超时问题(结合项目中的TxLCNf框架)1.消费方超时 这里是指，服务方等待消费方返回事务的消息，等待超时(结合txlcn框架来说)；在txlcn分布式事务框架中，消费方调用服务方的接口，调用成功后，睡10s，在提交事务；此时在服务方会报超时的错误信息，该错误和txlcn的配置项： tm.compensate.maxWaitTime&#x3D;xxxx 有关"}</script><link rel="alternative" href="/atom.xml" title="绿色薄荷" type="application/atom+xml"><link rel="icon" href="/img/favicon.png"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.12/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/pace/1.0.2/pace.min.js"></script><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/e-style.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="/js/globalUtils.js"></script><link rel="stylesheet" href="/live2d/waifu.css"><script type="text/javascript" async src="/live2d/autoload.js"></script></head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="绿色薄荷" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/media">影音</a><a class="navbar-item" href="/album">相册</a><a class="navbar-item" href="/friend">友链</a><a class="navbar-item" href="/self-talking">碎碎念</a><a class="navbar-item" href="/message">留言</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/HeRui2812"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Suche" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="/js/theme-setting.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2019-11-19  <a class="commentCountImg" href="/2019/11/19/feign-time-out-problem-with-txlcn/#comment-container"><span class="display-none-class">f935b624ffa8c9c656cb7a4f94a385fa</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="f935b624ffa8c9c656cb7a4f94a385fa">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>20 m  <i class="fas fa-pencil-alt"> </i>3.0 k</span><span class="level-item" id="busuanzi_container_page_pv"><i class="far fa-eye"></i>&nbsp;&nbsp;<span id="busuanzi_value_page_pv">0</span> Besuche</span></div></div><h1 class="title is-3 is-size-4-mobile">Feign服务间调用超时问题(结合项目中的TxLCNf框架)</h1><div class="content"><h3 id="Feign服务间调用超时问题-结合项目中的TxLCNf框架"><a href="#Feign服务间调用超时问题-结合项目中的TxLCNf框架" class="headerlink" title="Feign服务间调用超时问题(结合项目中的TxLCNf框架)"></a>Feign服务间调用超时问题(结合项目中的TxLCNf框架)</h3><h4 id="1-消费方超时"><a href="#1-消费方超时" class="headerlink" title="1.消费方超时"></a>1.消费方超时</h4><blockquote>
<p>这里是指，服务方等待消费方返回事务的消息，等待超时(结合txlcn框架来说)；在txlcn分布式事务框架中，消费方调用服务方的接口，调用成功后，睡10s，在提交事务；此时在服务方会报超时的错误信息，该错误和txlcn的配置项： tm.compensate.maxWaitTime=xxxx 有关 </p>
</blockquote>
<a id="more"></a>
<p>正常调用的日志信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">X-Requested-Inner&gt;&gt;&gt;bi@123jiao!678suo</span><br><span class="line">btc测试调用...</span><br><span class="line">15:00:44.244 [http-nio-18301-exec-1] DEBUG c.b.s.b.m.B.test - [debug,159] - &#x3D;&#x3D;&gt;  Preparing: update dapp_u_user_info set modify_time&#x3D;now(),email&#x3D;? where user_id&#x3D;? </span><br><span class="line">15:00:44.245 [http-nio-18301-exec-1] DEBUG c.b.s.b.m.B.test - [debug,159] - &#x3D;&#x3D;&gt; Parameters: demo11(String), a297a261-4f6e-49bc-9a94-a9785f58bd9c(String)</span><br><span class="line">15:00:44.260 [http-nio-18301-exec-1] DEBUG c.b.s.b.m.B.test - [debug,159] - &lt;&#x3D;&#x3D;    Updates: 1</span><br><span class="line">15:00:44.271 [sender-thread-6] INFO  c.c.t.f.u.SocketManager - [sleepSend,85] - send-msg-&gt;&#123;&quot;a&quot;:&quot;atg&quot;,&quot;k&quot;:&quot;zkZcP6tG&quot;,&quot;p&quot;:&#123;&quot;s&quot;:0,&quot;t&quot;:&quot;15ZfwYcQ&quot;,&quot;ms&quot;:&quot;public void com.blockchain.server.btc.service.impl.BtcWalletTransferServiceImpl.test(java.lang.String,java.lang.String)&quot;,&quot;g&quot;:&quot;4M3czL7a&quot;&#125;&#125;</span><br><span class="line"> maxOutTime : 5000</span><br><span class="line">15:00:44.323 [Thread-109] INFO  c.c.t.d.r.LCNDBConnection - [transaction,160] - transaction is wait for TxManager notify, groupId 4M3czL7a</span><br><span class="line">15:00:44.323 [receiver-thread-32] INFO  c.c.t.n.s.i.NettyControlServiceImpl - [executeService,84] - receive response -&gt; &#123;&quot;d&quot;:&quot;&#123;\&quot;st\&quot;:1571209243109,\&quot;r\&quot;:0,\&quot;s\&quot;:0,\&quot;nt\&quot;:1571209244322,\&quot;g\&quot;:\&quot;4M3czL7a\&quot;,\&quot;i\&quot;:0,\&quot;o\&quot;:0&#125;&quot;,&quot;k&quot;:&quot;zkZcP6tG&quot;&#125;</span><br><span class="line">15:00:44.326 [http-nio-18301-exec-1] INFO  c.c.t.s.l.ServerListener - [onApplicationEvent,27] - onApplicationEvent -&gt; onApplicationEvent. </span><br><span class="line">15:00:44.326 [TxInit-thread] INFO  c.c.t.l.s.i.InitServiceImpl - [start,24] - socket-start..</span><br><span class="line">15:00:44.452 [receiver-thread-33] INFO  c.c.t.n.s.i.NettyControlServiceImpl - [executeService,77] - receive cmd -&gt; &#123;&quot;a&quot;:&quot;t&quot;,&quot;c&quot;:1,&quot;t&quot;:&quot;15ZfwYcQ&quot;,&quot;k&quot;:&quot;DYsnIZt8&quot;&#125;</span><br><span class="line">15:00:44.452 [receiver-thread-33] INFO  c.c.t.c.s.i.ActionTServiceImpl - [execute,35] - accept notify data -&gt;&#123;&quot;a&quot;:&quot;t&quot;,&quot;c&quot;:1,&quot;t&quot;:&quot;15ZfwYcQ&quot;,&quot;k&quot;:&quot;DYsnIZt8&quot;&#125;</span><br><span class="line">15:00:44.484 [Thread-109] INFO  c.c.t.d.r.LCNDBConnection - [transaction,176] - lcn transaction over, res -&gt; groupId:4M3czL7a and  state is commit</span><br></pre></td></tr></table></figure>

<p>超时时服务方打印的信息(调用方线程睡了<code>10s</code>)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">btc测试调用...</span><br><span class="line">15:07:24.676 [http-nio-18301-exec-4] DEBUG c.b.s.b.m.B.test - [debug,159] - &#x3D;&#x3D;&gt;  Preparing: update dapp_u_user_info set modify_time&#x3D;now(),email&#x3D;? where user_id&#x3D;? </span><br><span class="line">15:07:24.677 [http-nio-18301-exec-4] DEBUG c.b.s.b.m.B.test - [debug,159] - &#x3D;&#x3D;&gt; Parameters: demo11(String), a297a261-4f6e-49bc-9a94-a9785f58bd9c(String)</span><br><span class="line">15:07:24.680 [http-nio-18301-exec-4] DEBUG c.b.s.b.m.B.test - [debug,159] - &lt;&#x3D;&#x3D;    Updates: 1</span><br><span class="line"> maxOutTime : 5000</span><br><span class="line">15:07:24.713 [sender-thread-7] INFO  c.c.t.f.u.SocketManager - [sleepSend,85] - send-msg-&gt;&#123;&quot;a&quot;:&quot;atg&quot;,&quot;k&quot;:&quot;i2eAfrw4&quot;,&quot;p&quot;:&#123;&quot;s&quot;:0,&quot;t&quot;:&quot;k7Sa0UmX&quot;,&quot;ms&quot;:&quot;public void com.blockchain.server.btc.service.impl.BtcWalletTransferServiceImpl.test(java.lang.String,java.lang.String)&quot;,&quot;g&quot;:&quot;HkDIt5SU&quot;&#125;&#125;</span><br><span class="line">15:07:24.714 [Thread-127] INFO  c.c.t.d.r.LCNDBConnection - [transaction,160] - transaction is wait for TxManager notify, groupId HkDIt5SU</span><br><span class="line">15:07:24.726 [receiver-thread-61] INFO  c.c.t.n.s.i.NettyControlServiceImpl - [executeService,84] - receive response -&gt; &#123;&quot;d&quot;:&quot;&#123;\&quot;st\&quot;:1571209643257,\&quot;r\&quot;:0,\&quot;s\&quot;:0,\&quot;nt\&quot;:1571209644723,\&quot;g\&quot;:\&quot;HkDIt5SU\&quot;,\&quot;i\&quot;:0,\&quot;o\&quot;:0&#125;&quot;,&quot;k&quot;:&quot;i2eAfrw4&quot;&#125;</span><br><span class="line">15:07:24.749 [http-nio-18301-exec-4] INFO  c.c.t.s.l.ServerListener - [onApplicationEvent,27] - onApplicationEvent -&gt; onApplicationEvent. </span><br><span class="line">15:07:24.754 [TxInit-thread] INFO  c.c.t.l.s.i.InitServiceImpl - [start,24] - socket-start..</span><br><span class="line">auto execute ,groupId:HkDIt5SU</span><br><span class="line">15:07:29.713 [sender-thread-8] INFO  c.c.t.f.u.SocketManager - [sleepSend,85] - send-msg-&gt;&#123;&quot;a&quot;:&quot;ckg&quot;,&quot;k&quot;:&quot;GEC41B1Q&quot;,&quot;p&quot;:&#123;&quot;t&quot;:&quot;datasource_k7Sa0UmX&quot;,&quot;g&quot;:&quot;HkDIt5SU&quot;&#125;&#125;</span><br><span class="line">15:07:29.718 [receiver-thread-62] INFO  c.c.t.n.s.i.NettyControlServiceImpl - [executeService,84] - receive response -&gt; &#123;&quot;d&quot;:&quot;0&quot;,&quot;k&quot;:&quot;GEC41B1Q&quot;&#125;</span><br><span class="line">15:07:29.740 [Thread-127] INFO  c.c.t.d.r.LCNDBConnection - [transaction,176] - lcn transaction over, res -&gt; groupId:HkDIt5SU and  state is rollback</span><br><span class="line">15:07:34.783 [receiver-thread-63] INFO  c.c.t.n.s.i.NettyControlServiceImpl - [executeService,77] - receive cmd -&gt; &#123;&quot;a&quot;:&quot;t&quot;,&quot;c&quot;:0,&quot;t&quot;:&quot;k7Sa0UmX&quot;,&quot;k&quot;:&quot;e0JwOnHP&quot;&#125;</span><br><span class="line">15:07:34.784 [receiver-thread-63] INFO  c.c.t.c.s.i.ActionTServiceImpl - [execute,35] - accept notify data -&gt;&#123;&quot;a&quot;:&quot;t&quot;,&quot;c&quot;:0,&quot;t&quot;:&quot;k7Sa0UmX&quot;,&quot;k&quot;:&quot;e0JwOnHP&quot;&#125;</span><br><span class="line">15:07:34.784 [receiver-thread-63] INFO  c.c.t.c.s.i.ActionTServiceImpl - [execute,66] - accept notify response res -&gt;0</span><br><span class="line">15:07:34.785 [receiver-thread-63] INFO  c.c.t.c.s.i.TransactionControlServiceImpl - [notifyTransactionMsg,50] - send notify data -&gt;&#123;&quot;p&quot;:&#123;&quot;d&quot;:&quot;0&quot;&#125;,&quot;a&quot;:&quot;t&quot;,&quot;k&quot;:&quot;e0JwOnHP&quot;&#125;</span><br><span class="line">15:07:34.787 [receiver-thread-64] INFO  c.c.t.n.s.i.NettyControlServiceImpl - [executeService,84] - receive response -&gt; &#123;&quot;d&quot;:&quot;&quot;,&quot;k&quot;:&quot;e0JwOnHP&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>上面可以看到<code>15:07:24</code>开始执行，<code>15:07:29 [Thread-127] INFO  c.c.t.d.r.LCNDBConnection - [transaction,176] - lcn transaction over, res -&gt; groupId:HkDIt5SU and  state is rollback</code>事务回滚，中间相差5s，这应该就是超时时间</p>
<p>增加超时时间，增加到<code>15s</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#指的是模块执行自动超时的最大时间，该最大时间若过段会导致事务机制异常，该时间必须要模块之间通讯的最大超过时间。</span><br><span class="line">#例如，若模块A与模块B，请求超时的最大时间是5秒，则建议改时间至少大于5秒。</span><br><span class="line">tm.compensate.maxWaitTime&#x3D;5000</span><br><span class="line">修改为</span><br><span class="line">tm.compensate.maxWaitTime&#x3D;15000</span><br><span class="line">这是打印出的日志就是：</span><br><span class="line"></span><br><span class="line">btc测试调用...</span><br><span class="line">15:23:04.886 [http-nio-18301-exec-1] DEBUG c.b.s.b.m.B.test - [debug,159] - &#x3D;&#x3D;&gt;  Preparing: update dapp_u_user_info set modify_time&#x3D;now(),email&#x3D;? where user_id&#x3D;? </span><br><span class="line">15:23:04.912 [http-nio-18301-exec-1] DEBUG c.b.s.b.m.B.test - [debug,159] - &#x3D;&#x3D;&gt; Parameters: demo11(String), a297a261-4f6e-49bc-9a94-a9785f58bd9c(String)</span><br><span class="line">15:23:04.915 [http-nio-18301-exec-1] DEBUG c.b.s.b.m.B.test - [debug,159] - &lt;&#x3D;&#x3D;    Updates: 1</span><br><span class="line"> maxOutTime : 15000</span><br><span class="line">15:23:04.920 [sender-thread-2] INFO  c.c.t.f.u.SocketManager - [sleepSend,85] - send-msg-&gt;&#123;&quot;a&quot;:&quot;atg&quot;,&quot;k&quot;:&quot;iOAoPJY7&quot;,&quot;p&quot;:&#123;&quot;s&quot;:0,&quot;t&quot;:&quot;M7jajJVi&quot;,&quot;ms&quot;:&quot;public void com.blockchain.server.btc.service.impl.BtcWalletTransferServiceImpl.test(java.lang.String,java.lang.String)&quot;,&quot;g&quot;:&quot;TabNLFcw&quot;&#125;&#125;</span><br><span class="line">15:23:04.920 [Thread-86] INFO  c.c.t.d.r.LCNDBConnection - [transaction,160] - transaction is wait for TxManager notify, groupId TabNLFcw</span><br><span class="line">15:23:04.926 [receiver-thread-5] INFO  c.c.t.n.s.i.NettyControlServiceImpl - [executeService,84] - receive response -&gt; &#123;&quot;d&quot;:&quot;&#123;\&quot;st\&quot;:1571210583545,\&quot;r\&quot;:0,\&quot;s\&quot;:0,\&quot;nt\&quot;:1571210584925,\&quot;g\&quot;:\&quot;TabNLFcw\&quot;,\&quot;i\&quot;:0,\&quot;o\&quot;:0&#125;&quot;,&quot;k&quot;:&quot;iOAoPJY7&quot;&#125;</span><br><span class="line">15:23:04.959 [http-nio-18301-exec-1] INFO  c.c.t.s.l.ServerListener - [onApplicationEvent,27] - onApplicationEvent -&gt; onApplicationEvent. </span><br><span class="line">15:23:04.960 [TxInit-thread] INFO  c.c.t.l.s.i.InitServiceImpl - [start,24] - socket-start..</span><br><span class="line">15:23:14.998 [receiver-thread-6] INFO  c.c.t.n.s.i.NettyControlServiceImpl - [executeService,77] - receive cmd -&gt; &#123;&quot;a&quot;:&quot;t&quot;,&quot;c&quot;:1,&quot;t&quot;:&quot;M7jajJVi&quot;,&quot;k&quot;:&quot;IdasBdx2&quot;&#125;</span><br><span class="line">15:23:14.998 [receiver-thread-6] INFO  c.c.t.c.s.i.ActionTServiceImpl - [execute,35] - accept notify data -&gt;&#123;&quot;a&quot;:&quot;t&quot;,&quot;c&quot;:1,&quot;t&quot;:&quot;M7jajJVi&quot;,&quot;k&quot;:&quot;IdasBdx2&quot;&#125;</span><br><span class="line">15:23:15.027 [Thread-86] INFO  c.c.t.d.r.LCNDBConnection - [transaction,176] - lcn transaction over, res -&gt; groupId:TabNLFcw and  state is commit</span><br></pre></td></tr></table></figure>
<p>从上面的日志信息可知程序在<code>15:23:04</code>秒开始执行，在<code>15:23:15</code>秒执行成功，并成功提交事务，<code>main-Thread</code>睡了<code>10</code>秒模拟超时，修改<code>tx</code>配置文件，最后成功提交事务。</p>
<hr>
<p>####2.服务方超时</p>
<blockquote>
<p>服务方超时：这里是指消费方调用服务方接口超时，和feign的配置有关</p>
</blockquote>
<p>在服务方方法中睡<code>30s</code>,结果消费方在<code>3s</code>后报超时的错误，返回500到前端；服务方在等待<code>30s</code>后，出现如下面错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">btc测试调用...</span><br><span class="line">15:53:50.921 [DiscoveryClient-CacheRefreshExecutor-0] INFO  c.c.t.s.l.ServerListener - [onApplicationEvent,27] - onApplicationEvent -&gt; onApplicationEvent. </span><br><span class="line">15:53:50.922 [TxInit-thread] INFO  c.c.t.l.s.i.InitServiceImpl - [start,24] - socket-start..</span><br><span class="line">15:53:57.872 [http-nio-18301-exec-4] DEBUG c.b.s.b.m.B.test - [debug,159] - &#x3D;&#x3D;&gt;  Preparing: update dapp_u_user_info set modify_time&#x3D;now(),email&#x3D;? where user_id&#x3D;? </span><br><span class="line">15:53:57.873 [http-nio-18301-exec-4] DEBUG c.b.s.b.m.B.test - [debug,159] - &#x3D;&#x3D;&gt; Parameters: demo12(String), a297a261-4f6e-49bc-9a94-a9785f58bd9c(String)</span><br><span class="line">15:53:57.875 [http-nio-18301-exec-4] DEBUG c.b.s.b.m.B.test - [debug,159] - &lt;&#x3D;&#x3D;    Updates: 1</span><br><span class="line"> maxOutTime : 15000</span><br><span class="line">15:53:57.875 [Thread-123] INFO  c.c.t.d.r.LCNDBConnection - [transaction,160] - transaction is wait for TxManager notify, groupId kcxZJOnG</span><br><span class="line">15:53:57.876 [sender-thread-5] INFO  c.c.t.f.u.SocketManager - [sleepSend,85] - send-msg-&gt;&#123;&quot;a&quot;:&quot;atg&quot;,&quot;k&quot;:&quot;sMitKicP&quot;,&quot;p&quot;:&#123;&quot;s&quot;:0,&quot;t&quot;:&quot;Z0N0azcs&quot;,&quot;ms&quot;:&quot;public void com.blockchain.server.btc.service.impl.BtcWalletTransferServiceImpl.test(java.lang.String,java.lang.String)&quot;,&quot;g&quot;:&quot;kcxZJOnG&quot;&#125;&#125;</span><br><span class="line">15:53:57.878 [receiver-thread-55] INFO  c.c.t.n.s.i.NettyControlServiceImpl - [executeService,84] - receive response -&gt; &#123;&quot;d&quot;:&quot;&quot;,&quot;k&quot;:&quot;sMitKicP&quot;&#125;</span><br><span class="line">15:53:57.879 [http-nio-18301-exec-4] WARN  c.c.t.a.s.i.TxRunningTransactionServerImpl - [execute,105] - wake the waitTask: true</span><br><span class="line">15:53:57.879 [http-nio-18301-exec-4] ERROR c.b.s.b.c.GlobalExceptionHandle - [handleUnknownException,60] - Wed Oct 16 15:53:57 CST 2019系统抛出异常，异常是：java.lang.reflect.UndeclaredThrowableException，异常信息是：null</span><br><span class="line">15:53:57.879 [http-nio-18301-exec-4] ERROR c.b.s.b.c.GlobalExceptionHandle - [handleUnknownException,64] - 请求路径：http:&#x2F;&#x2F;SKY-20180728BUM:18301&#x2F;inner&#x2F;walletTx&#x2F;test</span><br><span class="line">15:53:57.880 [http-nio-18301-exec-4] ERROR c.b.s.b.c.GlobalExceptionHandle - [handleUnknownException,67] - 响应头：null</span><br><span class="line">java.lang.reflect.UndeclaredThrowableException</span><br><span class="line">	at com.blockchain.server.btc.service.impl.BtcWalletTransferServiceImpl$$EnhancerBySpringCGLIB$$3b11ec8b.test(&lt;generated&gt;)</span><br><span class="line">	at com.blockchain.server.btc.inner.BtcWalletTransferInner.test(BtcWalletTransferInner.java:56)</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span><br><span class="line">	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class="line">	at java.lang.reflect.Method.invoke(Method.java:498)</span><br><span class="line">	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:209)</span><br><span class="line">	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:136)</span><br><span class="line">	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102)</span><br><span class="line">	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:877)</span><br><span class="line">	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:783)</span><br><span class="line">	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)</span><br><span class="line">	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:991)</span><br><span class="line">	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:925)</span><br><span class="line">	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:974)</span><br><span class="line">	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:877)</span><br><span class="line">	at javax.servlet.http.HttpServlet.service(HttpServlet.java:707)</span><br><span class="line">	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:851)</span><br><span class="line">	at javax.servlet.http.HttpServlet.service(HttpServlet.java:790)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">	at org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.filterAndRecordMetrics(WebMvcMetricsFilter.java:158)</span><br><span class="line">	at org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.filterAndRecordMetrics(WebMvcMetricsFilter.java:126)</span><br><span class="line">	at org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.doFilterInternal(WebMvcMetricsFilter.java:111)</span><br><span class="line">	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">	at com.alibaba.druid.support.http.WebStatFilter.doFilter(WebStatFilter.java:123)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">	at com.blockchain.server.base.filter.XssFilter.doFilter(XssFilter.java:56)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">	at org.springframework.boot.actuate.web.trace.servlet.HttpTraceFilter.doFilterInternal(HttpTraceFilter.java:90)</span><br><span class="line">	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:99)</span><br><span class="line">	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">	at org.springframework.web.filter.HttpPutFormContentFilter.doFilterInternal(HttpPutFormContentFilter.java:109)</span><br><span class="line">	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">	at org.springframework.web.filter.HiddenHttpMethodFilter.doFilterInternal(HiddenHttpMethodFilter.java:93)</span><br><span class="line">	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">	at org.springframework.session.web.http.SessionRepositoryFilter.doFilterInternal(SessionRepositoryFilter.java:147)</span><br><span class="line">	at org.springframework.session.web.http.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:81)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:200)</span><br><span class="line">	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:198)</span><br><span class="line">	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)</span><br><span class="line">	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:496)</span><br><span class="line">	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:140)</span><br><span class="line">	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:81)</span><br><span class="line">	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:87)</span><br><span class="line">	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342)</span><br><span class="line">	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:803)</span><br><span class="line">	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)</span><br><span class="line">	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:790)</span><br><span class="line">	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1468)</span><br><span class="line">	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)</span><br><span class="line">	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class="line">	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)</span><br><span class="line">	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)</span><br><span class="line">	at java.lang.Thread.run(Thread.java:748)</span><br><span class="line">Caused by: com.lorne.core.framework.exception.ServiceException: update TxGroup error, groupId:kcxZJOnG</span><br><span class="line">	at com.codingapi.tx.aop.service.impl.TxRunningTransactionServerImpl.execute(TxRunningTransactionServerImpl.java:90)</span><br><span class="line">	at com.codingapi.tx.aop.service.impl.AspectBeforeServiceImpl.around(AspectBeforeServiceImpl.java:58)</span><br><span class="line">	at com.codingapi.tx.springcloud.interceptor.TxManagerInterceptor.around(TxManagerInterceptor.java:32)</span><br><span class="line">	at com.codingapi.tx.springcloud.interceptor.TransactionAspect.around(TransactionAspect.java:39)</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span><br><span class="line">	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class="line">	at java.lang.reflect.Method.invoke(Method.java:498)</span><br><span class="line">	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:644)</span><br><span class="line">	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:633)</span><br><span class="line">	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:70)</span><br><span class="line">	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:174)</span><br><span class="line">	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:92)</span><br><span class="line">	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:185)</span><br><span class="line">	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)</span><br><span class="line">	... 76 more</span><br><span class="line">15:53:57.882 [http-nio-18301-exec-4] INFO  c.c.t.s.l.ServerListener - [onApplicationEvent,27] - onApplicationEvent -&gt; onApplicationEvent. </span><br><span class="line">15:53:57.883 [TxInit-thread] INFO  c.c.t.l.s.i.InitServiceImpl - [start,24] - socket-start..</span><br><span class="line">15:53:57.903 [Thread-123] INFO  c.c.t.d.r.LCNDBConnection - [transaction,176] - lcn transaction over, res -&gt; groupId:kcxZJOnG and  state is rollback</span><br></pre></td></tr></table></figure>
<p>就是这个错误，之前我在测试机上面，看到多次，找不到原因</p>
<p>然后，这个<code>3s</code>就是之前用到了服务降级，在配置文件中</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">hystrix:</span></span><br><span class="line">  <span class="attr">command:</span></span><br><span class="line">    <span class="attr">default:</span></span><br><span class="line">      <span class="attr">execution:</span></span><br><span class="line">       <span class="attr">timeout:</span></span><br><span class="line">         <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment">#如果设置为false execution.isolation.thread.timeoutInMilliseconds配置无效</span></span><br><span class="line">       <span class="attr">isolation:</span></span><br><span class="line">         <span class="attr">thread:</span></span><br><span class="line">           <span class="attr">timeoutInMilliseconds:</span> <span class="number">3000</span> <span class="comment">#这个超时时间，就是消费方调用服务方的超时时间，3s内服务方没有返回就会报错</span></span><br></pre></td></tr></table></figure>
<p>网上找到三种解决方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1、设置Hystrix的超时时间，例如设置超时时间为5s</span><br><span class="line"></span><br><span class="line">    hystrix.command.default.execution.isolation.thread.timeoutInMilliseconds: 5000</span><br><span class="line"></span><br><span class="line">2、不设置Hystrix的超时时间</span><br><span class="line"></span><br><span class="line">    hystrix.command.default.execution.timeout.enabled: false</span><br><span class="line"></span><br><span class="line">3、禁用Hystrix</span><br><span class="line"></span><br><span class="line">    feign.hystrix.enabled: false</span><br></pre></td></tr></table></figure>
<p>先试试直接关了：<code>feign.hystrix.enabled: false</code><br>执行了差不多<code>5s</code>后，报了如下超时错误</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">16:07:36.481 [http-nio-10505-exec-1] DEBUG c.b.s.p.f.BTCFeign - [log,70] - [BTCFeign#test] &lt;--- ERROR SocketTimeoutException: Read timed out (5780ms)</span><br><span class="line">16:07:36.482 [http-nio-10505-exec-1] INFO  c.c.t.d.r.LCNStartConnection - [rollback,99] - rollback label</span><br></pre></td></tr></table></figure>
<p>应该还有一个超时时间，是的<br>在hystrix禁用后，feign调用的超时时间和下面两个配置有关</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#feign的配置</span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">hystrix:</span></span><br><span class="line">    <span class="comment">#开启熔断器</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">default:</span></span><br><span class="line">        <span class="attr">connectTimeout:</span> <span class="number">5000</span></span><br><span class="line">        <span class="attr">readTimeout:</span> <span class="number">5000</span></span><br><span class="line">        <span class="attr">loggerLevel:</span> <span class="string">BASIC</span></span><br><span class="line"><span class="comment">#ribbon的配置,它的配置</span></span><br><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="attr">ReadTimeout:</span> <span class="number">60000</span></span><br><span class="line">  <span class="attr">ConnectTimeout:</span> <span class="number">60000</span></span><br></pre></td></tr></table></figure>

<p>feign的超时：  </p>
<ol>
<li><p><code>hystrix.command.default.execution.isolation.thread.timeoutInMilliseconds</code></p>
<ul>
<li>在配置了<code>hystrix</code>情况下，超时时间和<code>hystrix</code>配置相关；</li>
<li>如果<code>feign</code>和<code>ribbon</code>都没有配置，此时hystrix的这个配置是无效的，取默认值<code>1s</code>；</li>
<li>如果配置了<code>feign</code>或者<code>ribbon</code>，且<code>feign</code>或<code>ribbon</code>的值小于<code>hystrix</code>配置的，<code>hystrix</code>的配置项依然无效，会取<code>feign</code>或者<code>ribbon</code>的值；</li>
<li><code>feign</code>和<code>ribbon</code>同时配置，<code>feign</code>的优先级高；  <blockquote>
<p>所以，<code>hystrix</code>的配置时间时，<code>feign</code>或<code>ribbon</code>必须配置要一个，且时间要小于他们；</p>
</blockquote>
</li>
</ul>
</li>
<li><p>在没有配置<code>hystrix</code>情况下，也没有<code>feign.client.config.connectTimeout|readTimeout</code>，没有<code>ribbon.ReadTimeout|ConnectTimeout</code>配置，默认是超时时间是<code>1s</code>；</p>
</li>
<li><p>在没有配置<code>hystrix</code>情况下，配置了<code>feign.client.config</code>和<code>ribbon</code>，前者优于后者，如果没有配置<code>feign.client.config</code>就取<code>ribbon</code>的配置时间</p>
</li>
</ol>
</div><ul class="post-copyright"><li><strong>Post Title: </strong><a href="https://HR2812.cn/2019/11/19/feign-time-out-problem-with-txlcn/">Feign服务间调用超时问题(结合项目中的TxLCNf框架)</a></li><li><strong>Post Author: </strong><a href="https://HR2812.cn">HeRui</a></li><li><strong>Post Link: </strong><a href="https://HR2812.cn/2019/11/19/feign-time-out-problem-with-txlcn/">https://HR2812.cn/2019/11/19/feign-time-out-problem-with-txlcn/</a></li><li><strong>Copyright Notice: </strong><span>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> unless stating additionally.</span></li></ul><div><div class="recommend-post"><span class="is-size-6 has-text-grey has-mr-7"># Related Post</span><br><span>  1.<a class="is-size-6" href="/2020/09/23/test/" target="_blank">test</a><br></span><span>  2.<a class="is-size-6" href="/2020/09/23/hello-world/" target="_blank">Hello World</a><br></span><span>  3.<a class="is-size-6" href="/2020/09/02/recently-life/" target="_blank">最近</a><br></span><span>  4.<a class="is-size-6" href="/2020/04/11/Java-code-optimization/" target="_blank">35 个 Java 代码优化魔鬼细节</a><br></span><span>  5.<a class="is-size-6" href="/2020/04/11/java-null-check/" target="_blank">如何在Java代码中去掉烦人的“!=null”</a><br></span><span>  6.<a class="is-size-6" href="/2020/03/25/spring-session-redis-problem-error-no-such-key/" target="_blank">解决使用redis作为session缓存报错Error:nosuchkey的问题</a><br></span><span>  7.<a class="is-size-6" href="/2020/03/21/springboot-controller-singleton-or-prototype/" target="_blank">springboot默认创建的bean是单实还是多例</a><br></span><span>  8.<a class="is-size-6" href="/2020/03/17/java-zip-file-optimize/" target="_blank">简直不敢想，我竟然把压缩20M文件从30秒优化到1秒...</a><br></span></div></div><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/social-share.js/1.0.16/css/share.min.css"><div class="social-share"></div><script src="https://cdnjs.loli.net/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Gefällt Ihnen der Artikel? Unterstützen Sie den Autor mit</h3><div class="buttons is-centered"><a class="button is-info donate"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>Alipay</span><span class="qrcode"><img src="https://raw.githubusercontent.com/removeif/blog_image/master/img/2019/20190802135456.png" alt="Alipay"></span></a><a class="button is-success donate"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>Wechat</span><span class="qrcode"><img src="https://raw.githubusercontent.com/removeif/blog_image/master/img/2019/20190802135550.png" alt="Wechat"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2019/11/19/some-multi-thread-utilClass-to-use/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">CountDownLatch、CyclicBarrier和Semaphore类的简单使用</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2019/11/19/how-to-use-interface-randomaccess/"><span class="level-item">RandomAccess这个空接口有何用</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><div class="title is-5">Kommentare</div><div id="comment-container"></div><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/gitalk/1.6.0/gitalk.css"><script> $.getScript('/js/gitalk.min.js', function () { 
            var gitalk = new Gitalk({
            language:'zh-CN',
            id: 'f935b624ffa8c9c656cb7a4f94a385fa',
            repo: 'blog_comment',
            owner: 'HeRui2812',
            clientID: '20a7139eb84edb95032f',
            clientSecret: '4d5f04ca884d6d9ac892145a888fd423e9163a1b',
            admin: ["HeRui2812"],
            createIssueManually: true,
            distractionFreeMode: false,
            perPage: 10,
            pagerDirection: 'last',
            
            
            enableHotKey: true,
            isLocked: false
        })
        gitalk.render('comment-container')});</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><!--!--><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="is-rounded" src="/img/avatar.png" alt="肉の丸子"></figure><p class="title is-size-4 is-block line-height-inherit">肉の丸子</p><p class="is-size-6 is-block">红肉下锅，白丸入口</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>阿尔及利亚</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">75</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Kategorien</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">38</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://weibo.com/u/23050419984" target="_blank" rel="noopener">Folgen</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/HeRui2812"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="Weibo" href="https://weibo.com/u/3050419984"><i class="fab fa-weibo"></i></a><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:760652415@qq.com"><i class="fa fa-envelope"></i></a><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="Next" href="https://HeRui2812.github.io"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div><div><hr><p id="hitokoto">:D 一言句子获取中...</p><script type="text/javascript" defer>function getYiyan(){
                                $.getJSON("https://v1.hitokoto.cn/", function (data) {
                                if(data){
                                    $('#hitokoto').html("");
                                    $('#hitokoto').append("<strong style='color: #3273dc;'>"+data.hitokoto+"</strong>"+
                                    "<p>"+"From《"+data.from+"》</p><p>Provider-"+data.creator+"</p>");
                                }});}
                                $(function (){getYiyan();$('#hitokoto').click(function(){getYiyan();})});</script></div></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">Latest Comment</h3><span class="body_hot_comment">Loading...Wait a Minute!</span></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">Letzte Einträge</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2020-09-23T02:07:32.000Z">2020-09-23</time></p><p class="title is-6"><a class="link-muted" href="/2020/09/23/test/">test</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-09-23T01:10:08.347Z">2020-09-23</time></p><p class="title is-6"><a class="link-muted" href="/2020/09/23/hello-world/">Hello World</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-09-01T17:54:17.000Z">2020-09-02</time></p><p class="title is-6"><a class="link-muted" href="/2020/09/02/recently-life/">最近</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-04-11T09:19:39.000Z">2020-04-11</time></p><p class="title is-6"><a class="link-muted" href="/2020/04/11/Java-code-optimization/">35 个 Java 代码优化魔鬼细节</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-04-11T06:14:25.000Z">2020-04-11</time></p><p class="title is-6"><a class="link-muted" href="/2020/04/11/java-null-check/">如何在Java代码中去掉烦人的“!=null”</a></p><p class="is-uppercase"></p></div></article></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archive</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2020/09/"><span class="level-start"><span class="level-item">September 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/04/"><span class="level-start"><span class="level-item">April 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/03/"><span class="level-start"><span class="level-item">March 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/01/"><span class="level-start"><span class="level-item">January 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/12/"><span class="level-start"><span class="level-item">December 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><a class="level is-mobile is-marginless" href="/archives/"><span class="level-start"><span class="level-item">查看全部&gt;&gt;</span></span></a></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/%E8%AE%B0%E5%BD%95%E4%B8%80%E4%B8%8B/"><span class="tag">记录一下</span><span class="tag is-grey-lightest">16</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java/"><span class="tag">Java</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Mybatis/"><span class="tag">Mybatis</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%9C%89%E9%81%93%E4%BA%91%E7%AC%94%E8%AE%B0/"><span class="tag">有道云笔记</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JavaScript/"><span class="tag">JavaScript</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Mysql/"><span class="tag">Mysql</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"><span class="tag">数据库</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%9D%A2%E8%AF%95/"><span class="tag">面试</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spring/"><span class="tag">Spring</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/123QQW/"><span class="tag">123QQW</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Angular/"><span class="tag">Angular</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hibernate/"><span class="tag">Hibernate</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Json/"><span class="tag">Json</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Resin/"><span class="tag">Resin</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Vue/"><span class="tag">Vue</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/redis/"><span class="tag">redis</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/velocity/"><span class="tag">velocity</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"><span class="tag">微服务</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><span class="tag">设计模式</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Element-UI/"><span class="tag">Element UI</span><span class="tag is-grey-lightest">1</span></a></div></div><div class="field is-grouped is-grouped-multiline"><a class="tags has-addons" href="/tags/"><span class="tag">查看全部&gt;&gt;</span></a></div></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe to Updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=removeifFeedsId&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="removeifFeedsId" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="Subscribe"></div></div><p class="help">输入邮箱开始订阅，更博后邮件通知！</p></form></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="绿色薄荷" height="28"></a><p class="size-small"><span>&copy; 2020 HeRui</span>  Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a> &amp; <a href="https://github.com/removeif/hexo-theme-amazing" target="_blank">Amazing</a> <br><span>© <a href="http://www.beian.miit.gov.cn/" target="_blank">湘ICP备17014602号</a><br></span><span>© 版权说明：[本网站所有内容均收集于互联网或自己创作,<br />&nbsp;&nbsp;&nbsp;&nbsp;方便于网友与自己学习交流，如有侵权，请<a href="/message" target="_blank">留言</a>，立即处理]<br /></span><span><span id="statistic-times">loading...</span><script>function createTime(time) {
            var n = new Date(time);
            now.setTime(now.getTime() + 250),
                days = (now - n) / 1e3 / 60 / 60 / 24,
                dnum = Math.floor(days),
                hours = (now - n) / 1e3 / 60 / 60 - 24 * dnum,
                hnum = Math.floor(hours),
            1 == String(hnum).length && (hnum = "0" + hnum),
                minutes = (now - n) / 1e3 / 60 - 1440 * dnum - 60 * hnum,
                mnum = Math.floor(minutes),
            1 == String(mnum).length && (mnum = "0" + mnum),
                seconds = (now - n) / 1e3 - 86400 * dnum - 3600 * hnum - 60 * mnum,
                snum = Math.round(seconds),
            1 == String(snum).length && (snum = "0" + snum),
                document.getElementById("statistic-times").innerHTML = "❤️Site from <strong>"+time.split(" ")[0].replace(/\//g,".")+"</strong> has existed <strong>" + dnum + "</strong> d <strong>" + hnum + "</strong> h <strong>" + mnum + "</strong> m <strong>" + snum + "</strong> s！❤️";
        }var now = new Date();setInterval("createTime('2020/09/22 00:00:00')", 250,"");</script><br></span><div class="size-small"><span>❤️Thx <strong><span id="busuanzi_value_site_uv">99+</span></strong> users <strong><span id="busuanzi_value_site_pv">99+</span></strong> visited！❤️</span></div></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/HeRui2812"><i class="fab fa-github"></i></a></p></div><div class="sideMusic"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="/js/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><meting-js style="width: auto;height: 2000px;" server="netease" type="playlist" id="2364053447" theme="#2980b9" loop="all" autoplay="false" order="list" storageName="aplayer-setting" lrctype="0" list-max-height="400px" fixed="true"></meting-js></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script>moment.locale("zh");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://HR2812.cn',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Zurück nach oben" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back-to-top.js" defer></script><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.12/js/lightgallery-all.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><!--!--><!--!--><!--!--><script src="/js/toc.js" defer></script><script src="/js/main.js" defer></script><script>$.getScript('/js/comment-issue-data.js',function(){loadIssueData('20a7139eb84edb95032f','4d5f04ca884d6d9ac892145a888fd423e9163a1b','HeRui2812','blog_comment',false);})</script><link rel="stylesheet" href="/css/insight.css"><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input class="searchbox-input ins-search-input" type="text" placeholder="Tippen Sie etwas..."><span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>(function (window) {
            var INSIGHT_CONFIG = {
                TRANSLATION: {
                    POSTS: 'Posts',
                    PAGES: 'Seiten',
                    CATEGORIES: 'Kategorien',
                    TAGS: 'Tags',
                    UNTITLED: '(Unbenannt)',
                },
                CONTENT_URL: '/content.json',
            };
            window.INSIGHT_CONFIG = INSIGHT_CONFIG;
        })(window);</script><script src="/js/insight.js" defer></script></body></html>